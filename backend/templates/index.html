<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Story Intervention: prototype</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/interaction.js') }}"></script>
</head>
<body>
    <!-- ÏãúÏûë Ïò§Î≤ÑÎ†àÏù¥ Ï†úÍ±∞Îê®: Î≥ÑÎèÑ /start ÌéòÏù¥ÏßÄ ÏÇ¨Ïö© -->

    <div class="container" id="main-container">
        <div class="header">
            <!-- <h1>Interactive Story Intervention: prototype</h1> -->
            <!-- <p>AI-assisted storytelling with interactive elements</p> -->
            <div id="story-theme" class="story-theme" style="display: none;">
                <div class="theme-badge">
                    <span id="theme-text"></span>
                </div>
            </div>
            <div class="header-actions">
                <a href="/start" class="header-btn">
                    <span>üèÅ</span>
                    <span>Back to Start</span>
                </a>
                <!-- <a href="/story_creating/" class="header-btn">
                    <span>üìö</span>
                    <span>Create Story</span>
                </a> -->
                <a href="/recordings" class="header-btn">
                    <span>üé§</span>
                    <span>Recordings</span>
                </a>
            </div>
        </div>

        <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
        <div class="main-layout">
            <!-- Target Words ÏÇ¨Ïù¥ÎìúÎ∞î (ÏôºÏ™Ω) -->
            <div class="left-sidebar">
                <div class="sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">üìö Target Words</div>
                        <button class="sidebar-toggle" onclick="toggleCollapsibleSidebar(this)">‚ñ∂</button>
                    </div>
                    <div class="sidebar-content" id="sidebarContent">
                        <div class="sidebar-tip" id="sidebarTip">üí° Click the word and practice!</div>
                        <div class="word-count" id="wordCount">0 Words</div>
                        <ul class="word-list" id="wordList">
                            <!-- Îã®Ïñ¥Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Î©îÏù∏ Ïä§ÌÜ†Î¶¨ ÏòÅÏó≠ -->
            <div class="story-main">
                <div id="story-container" class="story-container">
                    
                    <div class="image-container">
                        <div id="placeholder-image" class="placeholder-image">
                            Let's start the story!
                        </div>
                        <img id="story-image" class="story-image" style="display: none;" alt="Story Image">
                        
                        <!-- Î™©Ï†ÅÏßÄ ÏÑ†ÌÉù Î≤ÑÌäºÎì§ Ïª®ÌÖåÏù¥ÎÑà -->
                        <div id="destination-buttons-container" class="destination-buttons-container" style="display: none;">
                        </div>
                        
                        <!-- ÌÅ¥Î¶≠ Ïù∏ÌÑ∞ÎûôÏÖò Î≤ÑÌäºÎì§ Ïª®ÌÖåÏù¥ÎÑà -->
                        <div id="click-buttons-container" class="click-buttons-container" style="display: none;">
                            <!-- ÌôîÎ©¥ ÌÅ¥Î¶≠ÏùÑ ÏúÑÌïú Ïò§Î≤ÑÎ†àÏù¥ -->
                            <div id="click-screen-overlay" class="click-screen-overlay"></div>
                        </div>

                        <!-- ÏÑ†ÌÉùÏßÄ Î≤ÑÌäºÎì§ Ïª®ÌÖåÏù¥ÎÑà -->
                        <div id="choose-item-buttons-container" class="choose-item-buttons-container" style="display: none;">
                        </div>
                        
                        <div id="dialogue-overlay" class="dialogue-overlay">
                            <div class="dialogue-content">
                                <div id="dialogue-character" class="dialogue-character"></div>
                                <div id="dialogue-text" class="dialogue-text"></div>
                            </div>
                        </div>
                    </div>

                    <div class="controls-container">
                        

                        <div id="input-section" class="input-section">
                            <div class="input-area">
                                <input type="text" id="user-input" class="user-input" placeholder="Record the answer..." onkeypress="handleKeyPress(event)">
                                <button class="btn btn-primary" onclick="submitUserInput()">Send</button>
                                <button id="voice-btn" class="voice-btn" onclick="startVoiceInput()" title="Voice input">
                                    üé§
                                </button>
                            </div>
                        </div>

                        <div class="button-group">
                            <button id="next-btn" class="btn btn-primary" onclick="nextDialogue()" disabled>
                                ‚è≠Ô∏è Next dialogue
                            </button>
                            <button id="next-scene-btn" class="btn btn-secondary" onclick="nextScene()" disabled>
                                üé¨ Next scene
                            </button>
                            <button id="learned-words-btn" class="btn btn-info" onclick="getLearnedWords()" style="display: none;">
                                üìö Learned words
                            </button>
                            <button id="export-btn" class="btn btn-secondary" onclick="exportConversation()" style="display: none;">
                                üíæ Export
                            </button>
                        </div>

                        <div id="status-section" class="status-section" style="display: none;">
                            <div class="status-text" id="status-text"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mouth Shapes ÏÇ¨Ïù¥ÎìúÎ∞î (Ïò§Î•∏Ï™Ω) -->
            <div class="right-sidebar">
                <!-- Tip Messages (Mouth Sidebar ÏúÑÎ°ú Ïù¥Îèô) -->
                <div id="tip-message" class="tip-message" style="display: none;">
                    <span style="color: #ffd700; font-weight: bold;">üí° Parents:</span> <br> "Add all target words to your answer!"
                </div>
                <div id="tip-message-word" class="tip-message-word" style="display: none;">
                    <span style="color: #ffd700; font-weight: bold;">üí° Parents:</span> <br> "Speak the each target words!"
                </div>
                <div id="tip-message-mouth" class="tip-message-mouth" style="display: none;">
                    <span style="color: #ffd700; font-weight: bold;">üí° Parents:</span> <br> instrcut the mouth shapes to children.
                </div>
                <div class="mouth-sidebar">
                    <div class="mouth-sidebar-header">
                        <div class="mouth-sidebar-title">üëÑ Mouth Shapes</div>
                        <button class="sidebar-toggle" onclick="toggleCollapsibleSidebar(this)">‚ñ∂</button>
                    </div>
                    <div class="mouth-sidebar-content" id="mouthSidebarContent">
                        <div class="mouth-images-grid" id="mouthImagesGrid">
                            <!-- Ïó¨Îü¨ ÏûÖ Î™®Ïñë Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        </div>
                        <div class="sound-info" id="soundInfo">
                            <!-- ÏÜåÎ¶¨ Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Î™©Ï†ÅÏßÄ ÏÑ†ÌÉù ÌåùÏóÖ -->
    <div id="destination-popup-overlay" class="destination-popup-overlay" style="display: none;"></div>
    <div id="destination-popup" class="destination-popup" style="display: none;">
        <h3>üéØ Destination Selected!</h3>
        <p>If you want to select this destination, click one more time.</p>
    </div>

    <!-- Î™©Ï†ÅÏßÄ ÏÑ†ÌÉù ÌåùÏóÖ -->
    <div id="choose-item-popup-overlay" class="choose-item-popup-overlay" style="display: none;"></div>
    <div id="choose-item-popup" class="choose-item-popup" style="display: none;">
        <h3>üéØ Choose Item Selected!</h3>
        <p>If you want to select this item, click one more time.</p>
    </div>

    <!-- ÌÅ¥Î¶≠ ÏïÑÏù¥ÌÖú ÌåùÏóÖ -->
    <div id="click-item-popup-overlay" class="click-item-popup-overlay" style="display: none;"></div>
    <div id="click-item-popup" class="click-item-popup" style="display: none;">
        <h3>üéØ Click Item Selected!</h3>
        <p>If you want to practice this word, click one more time.</p>
    </div>

    <div id="notification" class="notification"></div>
</body>
</html>

